<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vôlei Roosevelt</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #f0f4f8;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }
        /* Padrão de fundo da quadra */
        .court-pattern {
            background-color: #ffb74d;
            background-image: linear-gradient(45deg, #ffa726 25%, transparent 25%, transparent 75%, #ffa726 75%, #ffa726), 
                              linear-gradient(45deg, #ffa726 25%, transparent 25%, transparent 75%, #ffa726 75%, #ffa726);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.9;
        }
        /* Scrollbar escondida para visual mais limpo no histórico */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Ícones ---
        const RotateIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>
        );
        const RotateCcwIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );
        const SettingsIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );
        const UndoIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
        );
        const SwapIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></svg>
        );
        const HistoryIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>
        );
        const XIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        // --- Componente MiniQuadra ---
        const MiniCourt = ({ positions }) => {
            return (
                <div className="w-full aspect-[4/3] bg-orange-100 border border-orange-300 rounded overflow-hidden flex flex-col">
                    {/* Rede */}
                    <div className="h-1.5 bg-gray-300 w-full mb-px"></div>
                    
                    <div className="flex-1 grid grid-cols-3 gap-px bg-orange-200 p-px">
                        {[4, 3, 2, 5, 6, 1].map(zone => (
                            <div key={zone} className={`flex items-center justify-center overflow-hidden ${zone === 1 ? 'bg-yellow-100' : 'bg-orange-300'}`}>
                                <span className="text-[8px] font-bold text-gray-800 leading-none truncate px-0.5">
                                    {positions[zone].substring(0, 4)}
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const initialPlayers = {
            1: "Levantador",
            2: "Ponta 1",
            3: "Central 1",
            4: "Oposto",
            5: "Ponta 2",
            6: "Central 2"
        };

        const App = () => {
            const [mode, setMode] = useState('setup'); 
            const [positions, setPositions] = useState(initialPlayers);
            const [libero, setLibero] = useState("Líbero");
            const [score, setScore] = useState({ us: 0, them: 0, setsUs: 0, setsThem: 0 });
            
            // Histórico de logs da partida (para visualização)
            const [gameLog, setGameLog] = useState([]);
            
            // Estado para abrir/fechar modal de histórico
            const [showHistoryModal, setShowHistoryModal] = useState(false);

            // Histórico para desfazer (Undo)
            const [historyStack, setHistoryStack] = useState([]);

            const historyEndRef = useRef(null);

            // Rolar para o fim do histórico quando abrir
            useEffect(() => {
                if (showHistoryModal && historyEndRef.current) {
                    historyEndRef.current.scrollIntoView({ behavior: "smooth" });
                }
            }, [showHistoryModal, gameLog]);

            // Salva estado para poder desfazer DEPOIS
            // Importante: Salvamos o gameLog no stack também para o Undo funcionar no log
            const saveToHistory = () => {
                const currentState = {
                    positions: {...positions},
                    score: {...score},
                    libero: libero,
                    gameLog: [...gameLog]
                };
                setHistoryStack(prev => [currentState, ...prev].slice(0, 20)); // Limite de 20 para memória
            };

            const undo = () => {
                if (historyStack.length === 0) return;
                const previous = historyStack[0];
                
                setPositions(previous.positions);
                setScore(previous.score);
                if (previous.libero !== undefined) setLibero(previous.libero);
                if (previous.gameLog !== undefined) setGameLog(previous.gameLog);
                
                setHistoryStack(prev => prev.slice(1));
            };

            const rotateTeam = () => {
                saveToHistory();
                
                // LÓGICA NOVA: Adiciona ponto para "Nós" automaticamente ao rodar
                const newUsScore = score.us + 1;
                const newScore = { ...score, us: newUsScore };
                setScore(newScore);

                // Registra o ponto no log (usando a formação que conquistou o ponto)
                const logEntry = {
                    id: Date.now(),
                    score: newScore,
                    positions: { ...positions },
                    teamScored: 'us'
                };
                setGameLog(prev => [...prev, logEntry]);

                // Realiza o rodízio
                setPositions(prev => ({
                    1: prev[2],
                    6: prev[1],
                    5: prev[6],
                    4: prev[5],
                    3: prev[4],
                    2: prev[3]
                }));
            };

            const reverseRotateTeam = () => {
                saveToHistory();
                setPositions(prev => ({
                    1: prev[6],
                    6: prev[5],
                    5: prev[4],
                    4: prev[3],
                    3: prev[2],
                    2: prev[1]
                }));
            };

            const swapLibero = (zone) => {
                saveToHistory();
                const playerOnCourt = positions[zone];
                const playerOnBench = libero;
                setPositions(prev => ({ ...prev, [zone]: playerOnBench }));
                setLibero(playerOnCourt);
            };

            const updateScore = (team, delta) => {
                saveToHistory();
                
                // Calculando novo placar
                const newScore = { ...score };
                newScore[team] = Math.max(0, newScore[team] + delta);
                
                setScore(newScore);

                // Se foi ponto (aumento), adiciona ao log
                if (delta > 0) {
                    const logEntry = {
                        id: Date.now(),
                        score: { ...newScore },
                        positions: { ...positions }, // Snapshot das posições atuais
                        teamScored: team
                    };
                    setGameLog(prev => [...prev, logEntry]);
                }
            };

            const handleNameChange = (zone, name) => {
                setPositions(prev => ({ ...prev, [zone]: name }));
            };

            if (mode === 'setup') {
                return (
                    <div className="min-h-screen bg-gray-100 p-4 pb-20">
                        <div className="max-w-md mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
                            <div className="bg-blue-800 p-4 text-white flex justify-between items-center">
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <SettingsIcon /> Configurar Time
                                </h1>
                                <button onClick={() => setMode('game')} className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded font-bold text-sm shadow transition">
                                    JOGAR
                                </button>
                            </div>
                            <div className="p-6 space-y-4">
                                <p className="text-sm text-gray-500 mb-4">Insira os nomes dos jogadores.</p>
                                <div className="grid gap-4">
                                    <div className="flex items-center gap-3 bg-purple-50 p-2 rounded border border-purple-200">
                                        <div className="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-sm">L</div>
                                        <div className="flex-1">
                                            <label className="text-xs text-purple-800 font-bold uppercase block">Líbero</label>
                                            <input type="text" value={libero} onChange={(e) => setLibero(e.target.value)} className="w-full bg-transparent border-b border-purple-300 focus:border-purple-500 outline-none py-1 text-gray-800 font-medium" placeholder="Nome do Líbero"/>
                                        </div>
                                    </div>
                                    {[4, 3, 2, 5, 6, 1].map(zone => (
                                        <div key={zone} className="flex items-center gap-3 bg-gray-50 p-2 rounded border border-gray-200">
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${zone === 1 ? 'bg-yellow-500 ring-2 ring-yellow-300' : 'bg-blue-600'}`}>
                                                {zone}
                                            </div>
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-400 font-bold uppercase block">Posição {zone}</label>
                                                <input type="text" value={positions[zone]} onChange={(e) => handleNameChange(zone, e.target.value)} className="w-full bg-transparent border-b border-gray-300 focus:border-blue-500 outline-none py-1 text-gray-800 font-medium" placeholder="Nome"/>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-800 flex flex-col items-center relative">
                    
                    {/* Header */}
                    <div className="w-full max-w-md bg-white shadow-xl z-10 rounded-b-3xl overflow-hidden mb-4">
                        <div className="flex justify-between items-center p-3 bg-gray-900 text-white">
                            <button onClick={() => setMode('setup')} className="p-2 hover:bg-gray-700 rounded-full"><SettingsIcon /></button>
                            <span className="font-bold tracking-wider text-sm">VÔLEI ROOSEVELT</span>
                            <div className="flex gap-1">
                                <button onClick={() => setShowHistoryModal(true)} className="p-2 hover:bg-gray-700 rounded-full relative">
                                    <HistoryIcon />
                                    {gameLog.length > 0 && (
                                        <span className="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-gray-900"></span>
                                    )}
                                </button>
                                <button onClick={undo} disabled={historyStack.length === 0} className={`p-2 rounded-full ${historyStack.length === 0 ? 'opacity-30' : 'hover:bg-gray-700'}`}>
                                    <UndoIcon />
                                </button>
                            </div>
                        </div>
                        
                        {/* Placar */}
                        <div className="flex justify-between items-center p-4">
                            <div className="flex flex-col items-center w-1/3">
                                <span className="text-gray-500 text-xs font-bold uppercase mb-1">Nós</span>
                                <div className="text-5xl font-bold text-blue-700 leading-none">{score.us}</div>
                                <div className="flex gap-2 mt-2">
                                    <button onClick={() => updateScore('us', -1)} className="w-8 h-8 bg-gray-200 rounded-full text-gray-600 font-bold">-</button>
                                    <button onClick={() => updateScore('us', 1)} className="w-8 h-8 bg-blue-100 rounded-full text-blue-700 font-bold border border-blue-200">+</button>
                                </div>
                            </div>
                            <div className="text-gray-300 font-light text-xl">X</div>
                            <div className="flex flex-col items-center w-1/3">
                                <span className="text-gray-500 text-xs font-bold uppercase mb-1">Eles</span>
                                <div className="text-5xl font-bold text-red-600 leading-none">{score.them}</div>
                                <div className="flex gap-2 mt-2">
                                    <button onClick={() => updateScore('them', -1)} className="w-8 h-8 bg-gray-200 rounded-full text-gray-600 font-bold">-</button>
                                    <button onClick={() => updateScore('them', 1)} className="w-8 h-8 bg-red-100 rounded-full text-red-700 font-bold border border-red-200">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Quadra Principal */}
                    <div className="flex-1 w-full max-w-md px-2 flex flex-col justify-center">
                        <div className="bg-white p-2 rounded-lg shadow-2xl overflow-hidden border-4 border-white relative">
                            <div className="absolute -top-3 right-4 bg-purple-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-2 border-2 border-white z-20">
                                <span>Fora: {libero}</span>
                            </div>
                            <div className="w-full h-4 bg-gray-300 pattern-grid-lg mb-1 flex items-center justify-center">
                                <span className="text-[10px] text-gray-500 font-bold tracking-[0.5em] uppercase">REDE</span>
                            </div>
                            <div className="grid grid-cols-3 gap-1 bg-orange-200 p-1 rounded aspect-[4/3]">
                                {[4, 3, 2].map(zone => (
                                    <div key={zone} className="relative bg-orange-400 bg-opacity-90 rounded flex flex-col items-center justify-center p-2 shadow-inner border border-orange-500/30">
                                        <span className="absolute top-1 left-2 text-orange-900/40 font-bold text-4xl select-none">{zone}</span>
                                        <div className="z-10 text-center">
                                            <p className="font-bold text-gray-900 text-sm md:text-base break-words leading-tight">{positions[zone]}</p>
                                        </div>
                                    </div>
                                ))}
                                {[5, 6, 1].map(zone => (
                                    <div key={zone} className={`relative rounded flex flex-col items-center justify-center p-2 shadow-inner border border-orange-500/30 ${zone === 1 ? 'bg-yellow-200 ring-4 ring-inset ring-yellow-400/50' : 'bg-orange-300'}`}>
                                        <span className="absolute top-1 left-2 text-orange-900/20 font-bold text-4xl select-none">{zone}</span>
                                        {zone === 1 && <div className="absolute -bottom-3 right-1/2 translate-x-1/2 bg-blue-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm uppercase z-20 whitespace-nowrap">Sacador</div>}
                                        <button onClick={() => swapLibero(zone)} className="absolute top-1 right-1 w-6 h-6 bg-purple-500 hover:bg-purple-600 text-white rounded-full flex items-center justify-center shadow-sm z-30 transition-transform active:scale-90" title={`Trocar com ${libero}`}>
                                            <SwapIcon />
                                        </button>
                                        <div className="z-10 text-center mt-2">
                                            <p className="font-bold text-gray-800 text-sm md:text-base break-words leading-tight">{positions[zone]}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Controles */}
                    <div className="w-full max-w-md p-4 pb-8">
                        <div className="flex gap-3">
                            <button onClick={reverseRotateTeam} className="bg-gray-600 hover:bg-gray-500 active:scale-95 transition-all text-white rounded-2xl px-6 shadow-lg shadow-gray-900/30 flex items-center justify-center">
                                <RotateCcwIcon />
                            </button>
                            <button onClick={rotateTeam} className="group flex-1 bg-blue-600 hover:bg-blue-500 active:scale-95 transition-all text-white rounded-2xl py-5 shadow-lg shadow-blue-900/50 flex items-center justify-center gap-3 relative overflow-hidden">
                                <div className="absolute inset-0 bg-gradient-to-r from-blue-500 to-blue-700 opacity-50"></div>
                                <span className="relative z-10 font-bold text-2xl tracking-widest uppercase">RODAR</span>
                                <div className="relative z-10 bg-white/20 p-2 rounded-full group-hover:rotate-180 transition-transform duration-500">
                                    <RotateIcon />
                                </div>
                            </button>
                        </div>
                    </div>

                    {/* Modal de Histórico */}
                    {showHistoryModal && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm transition-all" onClick={() => setShowHistoryModal(false)}>
                            <div className="bg-white w-full max-w-md h-[80vh] sm:h-[600px] rounded-t-3xl sm:rounded-2xl flex flex-col overflow-hidden animate-pop" onClick={e => e.stopPropagation()}>
                                <div className="bg-gray-100 p-4 border-b flex justify-between items-center">
                                    <h2 className="font-bold text-gray-800 flex items-center gap-2">
                                        <HistoryIcon className="text-blue-600"/> Histórico da Partida
                                    </h2>
                                    <button onClick={() => setShowHistoryModal(false)} className="p-2 hover:bg-gray-200 rounded-full">
                                        <XIcon className="text-gray-500"/>
                                    </button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
                                    {gameLog.length === 0 ? (
                                        <div className="text-center text-gray-400 mt-20">
                                            <p>Nenhum ponto registrado ainda.</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {gameLog.map((log, index) => (
                                                <div key={log.id} className="bg-white p-3 rounded-lg shadow-sm border border-gray-200 flex gap-3">
                                                    {/* Coluna Esquerda: Placar */}
                                                    <div className="flex flex-col items-center justify-center w-16 border-r border-gray-100 pr-3">
                                                        <span className="text-[10px] uppercase font-bold text-gray-400">Ponto {index + 1}</span>
                                                        <div className="font-mono font-bold text-xl my-1">
                                                            <span className={log.teamScored === 'us' ? 'text-blue-600' : 'text-gray-400'}>{log.score.us}</span>
                                                            <span className="text-gray-300 mx-1">-</span>
                                                            <span className={log.teamScored === 'them' ? 'text-red-600' : 'text-gray-400'}>{log.score.them}</span>
                                                        </div>
                                                        <div className={`text-[10px] font-bold px-1.5 py-0.5 rounded ${log.teamScored === 'us' ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}`}>
                                                            {log.teamScored === 'us' ? 'NÓS' : 'ELES'}
                                                        </div>
                                                    </div>

                                                    {/* Coluna Direita: Mini Quadra */}
                                                    <div className="flex-1">
                                                        <div className="text-[10px] text-gray-400 mb-1 flex justify-between">
                                                            <span>Posicionamento:</span>
                                                            <span className="text-yellow-600 font-bold">Saque: {log.positions[1]}</span>
                                                        </div>
                                                        <div className="w-full max-w-[120px]">
                                                            <MiniCourt positions={log.positions} />
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div ref={historyEndRef} />
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
